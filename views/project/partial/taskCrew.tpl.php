<?phpinclude_once TEMPLATE_PATH.'/site/helper/format.php';$task = $SOUP->get('task');$accepted = $SOUP->get('accepted', array());// num needed$numAccepted = $task->getNumAccepted();$numNeeded = $task->getNumNeeded();if($numNeeded == 0)	$numNeeded = '&#8734; people';else {	$numNeeded -= $numAccepted;	$numNeeded = formatCount($numNeeded,'person','people');}if(Session::isLoggedIn() && // must be logged in	($task->getLeaderID() != Session::getUserID()) && // can't join your own task	(!ProjectUser::isBanned(Session::getUserID(), $task->getProjectID())) && // can't be banned	(Accepted::getByUserID(Session::getUserID(), $task->getProjectID()) === null) && // can't have joined yet	($task->getStatus() === Task::STATUS_OPEN) ) { // task must be open	$hasPermission = true;} else {	$hasPermission = false;}$fork = $SOUP->fork();$fork->startBlockSet('body');$fork->set('title', 'Task Crew');$fork->set('creatable', $hasPermission);$fork->set('createLabel', 'Join');?><?php if($hasPermission): ?><script type="text/javascript">$(document).ready(function() {	var acceptButton = $('#accepted .createButton');	acceptButton.mousedown(function() {		buildPost({			'processPage': '<?= Url::taskProcess($task->getID()) ?>',			'info':{				'action': 'accept'			},			'buttonID': acceptButton		});	});});</script><?php endif; ?><p><?= $numNeeded ?> needed <span class="slash">/</span> <?= formatCount(count($accepted),'person','people') ?> joined</p><?phpif($accepted != null) {	echo '<div class="line"></div>';	echo '<p>';	foreach($accepted as $a) {		echo formatUserPicture($a->getCreatorID(), 'small').' ';	}	echo '</p>';	echo '<div class="clear"></div>';}	$fork->endBlockSet();$fork->render('site/partial/panel');