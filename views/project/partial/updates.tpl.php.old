<?phpinclude_once TEMPLATE_PATH.'/site/helper/format.php';$updates = $SOUP->get('updates', array());$accepted = $SOUP->get('accepted', null);$token = Upload::generateToken();$task = $SOUP->get('task');?><script type="text/javascript">$(document).ready(function(){	$('div.update input.cancel').mousedown(function(){		var updatePanel = $(this).parent().parent().parent().parent();		var edit = $(updatePanel).find('.edit');		var view = $(updatePanel).find('.view');		$(edit).hide();		$(view).fadeIn();	});	$('div.update input.save').mousedown(function(){		var updatePanel = $(this).parent().parent().parent().parent();		var updateID = updatePanel.attr('id').slice(7);		buildPost({			'processPage':'<?= Url::updatesProcess($accepted->getID()) ?>',			'info':{				'action':'edit-update',				'updateID':updateID,				'message':$(updatePanel).find('textarea').val()			},			'buttonID':$(this)		});	});	$('div.update input.editButton').mousedown(function(){		var updatePanel = $(this).parent().parent();		var edit = $(updatePanel).find('.edit');		var view = $(updatePanel).find('.view');		toggleEditView(edit, view);		if($(view).is(":hidden")) {			$(updatePanel).find('textarea').focus();		}	});});</script><?if($updates != null) {		for($i=(count($updates)); $i>0; $i--) {		$update = $updates[$i];		$uploads = Upload::getByUpdateID($update->getID(), false);				$fork = $SOUP->fork();		//$fork->set('title', html_entity_decode(formatTimeDiff($update->getDateCreated())));		$fork->set('title', 'Update #'.$i);		$fork->set('editable', true);		$fork->set('editLabel', "Edit Update");		$fork->set('id', 'update-'.$update->getID());		$fork->set('class', 'update');		$fork->startBlockSet('body');		?>				<div class="view">			<?php				//$SOUP->render('project/partial/uploads', array(				//	'uploads' => $uploads				//));			?>					<?= formatUpdate($update->getMessage()) ?>		</div><!-- end .view -->				<div class="edit hidden">			<textarea><?= html_entity_decode($update->getMessage()) ?></textarea>			<?php				$SOUP->render('site/partial/upload', array(					'token' => $token,					'item_type' => Upload::TYPE_UPDATE,					'item_id' => $update->getID()				));			?>						<div class="buttons">				<input class="right cancel" type="button" value="Cancel" />							<input class="right save" type="button" value="Save" />				<p class="right">Allowed tags: &lt;a&gt; &lt;strong&gt; &lt;b&gt; &lt;em&gt; &lt;i&gt;</p>			</div><!-- end .buttons -->		</div><!-- end .edit -->				<?php		$fork->endBlockSet();		$fork->startBlockSet('footer');		?>				<div class="buttons">				<input class="right" type="button" value="Comments (<?= rand(1,10) ?>)" />			<p class="updates">posted <?= formatTimeTag($update->getDateCreated()) ?> by <?= formatUserLink($update->getCreatorID()) ?></p>				</div><!-- end .buttons -->		<?php		$fork->endBlockSet();		$fork->render('site/partial/panel');		}} 